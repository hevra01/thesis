# =============================================================================
# Heuristic Token Count Predictor Training Configuration
# =============================================================================
# This config is used by training_heuristic.py to train the HeuristicTokenCountPredictor.
# The model predicts token counts from reconstruction loss + optional features (LID, density, etc.)
# No images are used - only precomputed scalar features.

defaults:
  - /model: token_predictor_heuristic_baseline
  - /dataset: imageNet

# =============================================================================
# Optimizer Configuration (single LR - no backbone/head split needed)
# =============================================================================
optimizer:
  _target_: torch.optim.Adam
  lr: 0.001

# =============================================================================
# Training Configuration
# =============================================================================
training:
  num_epochs: 100
  loss_training_classification:
    _target_: reconstruction_loss.GaussianCrossEntropyLoss
    sigma: 0.2

# =============================================================================
# Reconstruction Dataset Configuration
# =============================================================================
# This dataset provides reconstruction loss and optional features per image.
# No images are loaded - only tabular data from JSON files.

reconstruction_dataset:
  # -----------------------------------------------------------------
  # Reconstruction data paths (contain k_value, reconstruction losses, etc.)
  # -----------------------------------------------------------------
  reconstruction_train_data_path: "data/datasets/imagenet_reconstruction_losses/train/all_losses.json"
  reconstruction_test_data_path: "data/datasets/imagenet_reconstruction_losses/val_categorized/all_losses.json"

  # -----------------------------------------------------------------
  # Primary reconstruction loss key (used as the main input feature)
  # -----------------------------------------------------------------
  reconstruction_loss: "LPIPS"

  # -----------------------------------------------------------------
  # Additional feature keys to use as inputs to the MLP
  # These must match the keys returned by ReconstructionDataset_Heuristic
  # Options: "lid", "local_density", "edge_ratio", "lpips_variance", "dino_dist"
  # Set to empty list [] if only using reconstruction_loss
  # -----------------------------------------------------------------
  additional_feature_keys:
    - "lid"
    - "local_density"

  # -----------------------------------------------------------------
  # Feature file paths for TRAINING data
  # Set to null if the feature is not used
  # -----------------------------------------------------------------
  edge_ratio_path: null
  lid_path: "/BS/data_mani_compress/work/thesis/thesis/data/datasets/imageNet_LID_values/flextok_based/original_images/train/t_0.32/combined.json"
  local_density_path: "/BS/data_mani_compress/work/thesis/thesis/data/datasets/density_imagenet/original_train/unconditional/combined.json"
  lpips_variance_path: null
  dino_dist_path: "/BS/data_mani_compress/work/thesis/thesis/data/datasets/dino_distances/train/dino_nearest_centroid_distances.json"

  # -----------------------------------------------------------------
  # Feature file paths for VALIDATION data
  # Set to null if the feature is not used
  # -----------------------------------------------------------------
  edge_ratio_path_val: null
  lid_path_val: "/BS/data_mani_compress/work/thesis/thesis/data/datasets/imageNet_LID_values/flextok_based/original_images/val/t_0.32/combined.json"
  local_density_path_val: "/BS/data_mani_compress/work/thesis/thesis/data/datasets/density_imagenet/original_val/unconditional/combined.json"
  lpips_variance_path_val: null
  dino_dist_path_val: "/BS/data_mani_compress/work/thesis/thesis/data/datasets/dino_distances/val_categorized/dino_nearest_centroid_distances_cosine.json"

  # -----------------------------------------------------------------
  # DataLoader settings (can use large batch sizes since no images!)
  # -----------------------------------------------------------------
  batch_size: 512
  num_workers: 4

# =============================================================================
# Model Configuration (overrides defaults from model config)
# =============================================================================
model:
  # Number of token count classes to predict
  num_classes: 256

  # Must match len(additional_feature_keys) above
  # If additional_feature_keys = ["lid", "local_density"], then num_additional_features = 2
  num_additional_features: 2

  # Hidden layer dimension
  hidden_dim: 64

# =============================================================================
# Experiment Metadata
# =============================================================================
experiment_name: "heuristic_token_count_predictor"
project_name: "heuristic_baselines"
group_name: "heuristic_experiments"

# =============================================================================
# Checkpoint Paths
# =============================================================================
checkpoint_path_best: "/BS/data_mani_compress/work/thesis/thesis/heuristic_baseline/checkpoint/lpips_best.pt"
checkpoint_path_latest: "/BS/data_mani_compress/work/thesis/thesis/heuristic_baseline/checkpoint/lpips_latest.pt"
